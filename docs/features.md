# 功能特性说明文档

本文档详细说明了 Canvas 项目已实现的功能特性、交互逻辑及技术实现细节。

## 1. 基础渲染 (Basic Rendering)

项目采用 **PixiJS** 作为底层渲染引擎，确保高性能的图形绘制。

### 1.1 图形渲染
支持多种基础几何图形的绘制与属性配置：
-   **支持图形**：
    -   矩形 (Rectangle)
    -   圆形 (Circle)
    -   圆角矩形 (Rounded Rectangle)
    -   三角形 (Triangle)
-   **支持属性**：
    -   **背景色 (Fill)**: 支持 Hex 颜色值。
    -   **边框 (Stroke)**: 支持设置边框颜色和宽度。
    -   **圆角 (Border Radius)**: 仅针对圆角矩形，支持调节圆角大小。

### 1.2 图片渲染
支持导入本地图片并在画布上展示：
-   **格式支持**: PNG, JPEG。
-   **滤镜效果**:
    -   **灰度 (Grayscale)**: 将图片转换为黑白。
    -   **模糊 (Blur)**: 高斯模糊效果。
    -   **亮度 (Brightness)**: 调节图片明暗。

### 1.3 富文本渲染
支持文本元素的创建与样式编辑：
-   **基础属性**:
    -   字体 (Font Family): 支持 Arial, Times New Roman, Courier New, Georgia, Verdana。
    -   字号 (Font Size): 12px - 72px。
    -   颜色 (Color): 文本颜色。
    -   背景色 (Background): 文本框背景色。
-   **样式修饰 (BIUS)**:
    -   **B**old (加粗)
    -   **I**talic (斜体)
    -   **U**nderline (下划线)
    -   **S**trikethrough (删除线)

---

## 2. 画布交互 (Canvas Interaction)

基于 **PixiJS** 的变换矩阵实现无限画布体验。

### 2.1 视口控制
-   **缩放 (Zoom)**: 通过鼠标滚轮 (`Wheel`) 进行以鼠标为中心的缩放。
-   **平移 (Pan)**:
    -   按住鼠标中键拖拽。
    -   或在选择工具下，点击空白区域拖拽。
-   **无限画布**: 理论上支持无限大的坐标空间。

### 2.2 选区功能
-   **点选**: 点击单个元素进行选中。
-   **框选 (Marquee)**: 按住 `Shift` 键并拖拽鼠标，绘制选区框，选中与框相交的所有元素。
-   **多选**: 框选后，所有选中元素可作为一个整体进行移动或删除。

### 2.3 剪贴板
-   **复制 (Ctrl+C)**: 将当前选中元素的 JSON 数据序列化并存储到 `localStorage` (模拟剪贴板)。
-   **粘贴 (Ctrl+V)**:
    -   读取剪贴板数据。
    -   **智能定位**: 粘贴的内容会自动出现在**鼠标指针所在位置**的中心，而非固定偏移。

### 2.4 数据持久化
-   **自动保存**: 任何状态变更（添加、修改、删除元素）都会触发 `localStorage` 的更新。
-   **状态恢复**: 刷新页面后，自动从 `localStorage` 读取数据并还原画布状态。

---

## 3. 调参工具栏 (Floating Toolbar)

上下文感知的浮动工具栏，根据选中元素的类型动态展示配置项。

### 3.1 交互逻辑
-   **触发**: 选中单个元素时自动显示。
-   **位置**: 始终跟随选中元素，位于元素右上方。

### 3.2 功能模块
-   **文本模式**: 显示字体、字号、颜色选择器及 BIUS 按钮。
-   **图形模式**: 显示填充色、边框色、边框宽度输入框。
-   **图片模式**: 显示灰度、模糊、亮度调节滑块。

---

## 4. 元素编辑 (Element Editing)

### 4.1 文本编辑
-   **双击编辑**: 双击文本元素，原地激活输入框 (`contenteditable`)。
-   **实时更新**: 输入内容实时同步至 Canvas 渲染。

### 4.2 通用操作
-   **拖拽移动**: 选中元素后按住左键拖拽。
-   **缩放变换**: 选中元素后，通过周围的 8 个控制点 (Transformer) 进行缩放。
-   **删除**: 选中元素后按下 `Delete` 或 `Backspace` 键。

---

## 5. 性能优化 (Performance)

### 5.1 渲染性能
-   **目标**: 100+ 元素场景下，首屏渲染时间 < 3s。
-   **实现**:
    -   使用 **PixiJS** (WebGL) 替代传统的 DOM 或 Canvas 2D API，利用 GPU 加速渲染。
    -   **按需渲染**: 仅在 Store 状态变更时触发重绘。
    -   **资源缓存**: 图片资源加载后自动缓存，避免重复网络请求。

### 5.2 交互性能
-   **事件委托**: 统一在 Stage 层处理指针事件，避免为每个元素绑定过多监听器。
-   **数学计算**: 使用矩阵运算处理坐标转换 (Screen to World)，确保拖拽和缩放的流畅性。
